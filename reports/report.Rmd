```{r, echo=FALSE}
source('report-fun.R')
```

# Report for study: `r .study`

## Contact Information

**Data contributor:** `r .dat$contacts$name`

**Email:** `r paste0(.dat$contacts$email[.dat$contacts$email!=""], collapse = ", ")`

**Address:**

`r paste0("- ", .dat$contacts$address, collapse = "\n")`

## Data source

**Citation:** `r .dat$references$citation`

**DOI:** `r  paste0('[', bibGetElement(.dat$bibtex, element = "doi"), '](http://doi.org/', bibGetElement(.dat$bibtex, element = "doi"),')')`

**Abstract:** `r  bibGetElement(.dat$bibtex, element = "abstract")`

## Overview of data provided

The dataset includes records for `r length(.dat$data$studyName)` individuals from `r length(unique(.dat$data$species))` species belonging to `r length(unique(.dat$data$family))` family(ies), presenting `r length(unique(.dat$data$pft))` functional type(s), growing in `r length(unique(.dat$data$growingCondition))` condition(s) within `r length(unique(.dat$data$vegetation))` major type(s) of habitat, with data included for the following variables:

```{r results='asis', echo=FALSE, warning=FALSE}
options(digits=9)
kable(
	summaryTable(.dat$data, var.def= read.csv("../config/variableDefinitions.csv", stringsAsFactors=FALSE)),
	 "markdown", align="l", padding=10)
```


## Locations sampled

Data were sampled at the following locations:

```{r echo=FALSE, fig.width=12, fig.height=10, message=FALSE, warning=FALSE}
prepdata  <-  prepMapInfo(alldata$data, .study)
drawWorldPlot (prepdata)
```


And locally within the country:

```{r echo=FALSE, fig.width=12, fig.height=10, message=FALSE, warning=FALSE}
repMissingInfo(prepdata)
drawCountryPlot(prepdata)
```


The sites sampled are:

```{r echo=FALSE, message=FALSE, warning=FALSE, comment='',results='asis'}
kable(locLevelInfo(.dat$data),"markdown", align="l", padding=2)
```


The growing conditions of sampled plants was:

```{r echo=FALSE, message=FALSE, warning=FALSE, comment='', results="asis"}
kable(standLevelInfo(.dat$data),"markdown", align="l", padding=2)
```

## Species sampled

```{r echo=FALSE, message=FALSE, warning=FALSE, comment='',results="asis"}
kable(spLevelInfo(.dat$data), "markdown", align="l", padding=2)
```

## Methods used

```{r echo=FALSE, message=FALSE, warning=FALSE, comment='', results="asis"}
metaTable  <-  getMeta(.study)
writeLines(paste0("**",metaTable[,1],"**", ": ", metaTable[,2], "\n"))
```

## Plots of data

This is how the study `r .study` fits in the entire dataset (grey). each colour represents a species. A legend of species names with colours is included at the end for reports with 1 < n < 20 species.

```{r fig.height=12, fig.width=12, echo=FALSE, warning=FALSE, message=FALSE}
makePlotPanel(alldata, .dat)
```
